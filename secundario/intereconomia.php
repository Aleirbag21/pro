<?php

class Intereconomia extends cadena{

/*
http://mmp.streamuk.com/p/2000092/sp/200009200/playManifest/entryId/0_ln0d3cfl/format/rtmp/protocol/rtmp/ks/
ZTZiYjkyMDI4MjljOWZkYWQ3Y2E5NzBhOTA5YzVjMzc3ZjNmMThjZXwyMDAwMDkyOzIwMDAwOTI7MTQxMzU4NTM5MTswOzE0MTM0OTg5OTEuMjA1MTswO3ZpZXc6Kix3aWRnZXQ6MTs7
/uiConfId/11173656/a/a.f4m?referrer=
aHR0cDovL3d3dy5yYWRpb2ludGVyZWNvbm9taWEuY29tL3Byb2dyYW1hcy9jcm9uaWNhLTEv


http://mmp.streamuk.com/p/2000092/sp/200009200/playManifest/entryId/0_ln0d3cfl/format/rtmp/protocol/rtmp/ks/
e6bb9202829c9fdad7ca970a909c5c377f3f18ce|2000092;2000092;1413585391;0;1413498991.2051;0;view:*,widget:1;;
/uiConfId/11173656/a/a.f4m?referrer=
http://www.radiointereconomia.com/programas/cronica-1/


http://mmp.streamuk.com/p/2000092/sp/200009200/playManifest/entryId/0_ln0d3cfl/format/http/protocol/http/ks/
e6bb9202829c9fdad7ca970a909c5c377f3f18ce|2000092;2000092;1413585391;0;1413498991.2051;0;view:*,widget:1;;
/uiConfId/11173656/a/a.f4m?referrer=
http://www.radiointereconomia.com/programas/cronica-1/

<?xml version="1.0" encoding="UTF-8"?>
<manifest xmlns="http://ns.adobe.com/f4m/1.0">
	<id>0_ln0d3cfl</id>
	<mimeType>video/x-flv</mimeType>
	<streamType>recorded</streamType>					
	<duration>2524</duration>
	
	<media url="http://http.mmp.streamuk.com/content/entry/data/4/350/0_ln0d3cfl_0_sodum49h_1.mp4?nva=20141016234627&amp;token=02827936d25ec6a5dfc54" bitrate="65" width="0" height="0"/><media url="http://http.mmp.streamuk.com/content/entry/data/4/350/0_ln0d3cfl_0_d60nb59y_1.mp4?nva=20141016234627&amp;token=0f2662f4a80e7cc9db622" bitrate="129" width="0" height="0"/>
	
</manifest>


POST
http://mmp.streamuk.com//api_v3/index.php?service=multirequest&action=null&kalsig=f5bf715cb3bf8c099fc8a26b3ffc8ecc
Referer: http://open.http.mmp.streamuk.com/p/2000092/sp/200009200/flash/kdp3/v3.9.3.3.1.31/kdp3.swf Content-type: application/x-www-form-urlencoded Content-length: 728 2%3Aaction=getContextData&2%3AcontextDataParams%3AobjectType=KalturaEntryContextDataParams&3%3Afilter%3AobjectType=KalturaCuePointFilter&3%3Aaction=list&ignoreNull=1&2%3AcontextDataParams%3AstreamerType=rtmp&2%3AcontextDataParams%3Areferrer=http%3A%2F%2Fwww%2Eradiointereconomia%2Ecom%2Fprogramas%2Fcronica%2D1%2F&2%3AentryId=0%5Fln0d3cfl&1%3AentryId=0%5Fln0d3cfl&apiVersion=3%2E1%2E5&1%3Aservice=baseentry&ks=ZDJlMDAwNDI2ZTVkMzJhNDVhNGViMWYzMGUyNmE1YTIyMzhlZTE2M3wyMDAwMDkyOzIwMDAwOTI7MTQxMzU4NTc2NjswOzE0MTM0OTkzNjYuMDkwNzswO3ZpZXc6Kix3aWRnZXQ6MTs7&3%3Afilter%3AentryIdEqual=0%5Fln0d3cfl&1%3Aaction=get&3%3Aservice=cuepoint%5Fcuepoint&2%3Aservice=baseentry&1%3Aversion=%2D1&clientTag=kdp%3Av3%2E9%2E3%2Ccache%5Fst%3A1405425098
----------------
<?xml version="1.0" encoding="utf-8"?><xml><result><item><objectType>KalturaMediaEntry</objectType><id>0_ln0d3cfl</id><name>______________CRONICA_1_14_07</name><partnerId>2000092</partnerId><userId>multimedia@intereconomia.com</userId><creatorId>multimedia@intereconomia.com</creatorId><status>2</status><moderationStatus>6</moderationStatus><moderationCount>0</moderationCount><type>1</type><createdAt>1405423581</createdAt><updatedAt>1405424112</updatedAt><rank>0</rank><totalRank>0</totalRank><votes>0</votes><downloadUrl>http://open.http.mmp.streamuk.com/p/2000092/sp/200009200/raw/entry_id/0_ln0d3cfl/version/0</downloadUrl><searchText>_PAR_ONLY_ _2000092_ _MEDIA_TYPE_5| ______________CRONICA_1_14_07 </searchText><licenseType>-1</licenseType><version>0</version><thumbnailUrl>http://open.http.mmp.streamuk.com/p/2000092/sp/200009200/thumbnail/entry_id/0_ln0d3cfl/version/100000</thumbnailUrl><accessControlId>4000101</accessControlId><replacementStatus>0</replacementStatus><partnerSortValue>0</partnerSortValue><conversionProfileId>2000096</conversionProfileId><rootEntryId>0_ln0d3cfl</rootEntryId><operationAttributes></operationAttributes><entitledUsersEdit></entitledUsersEdit><entitledUsersPublish></entitledUsersPublish><plays>94</plays><views>0</views><duration>2524</duration><msDuration>2524000</msDuration><mediaType>5</mediaType><conversionQuality>2000096</conversionQuality><sourceType>6</sourceType><dataUrl>http://open.http.mmp.streamuk.com/p/2000092/sp/200009200/flvclipper/entry_id/0_ln0d3cfl/version/0</dataUrl><flavorParamsIds>0,33,31,40</flavorParamsIds></item><item><objectType>KalturaEntryContextDataResult</objectType><isSiteRestricted>0</isSiteRestricted><isCountryRestricted>0</isCountryRestricted><isSessionRestricted>0</isSessionRestricted><isIpAddressRestricted>0</isIpAddressRestricted><isUserAgentRestricted>0</isUserAgentRestricted><isScheduledNow>1</isScheduledNow><isAdmin>0</isAdmin><streamerType>rtmp</streamerType><mediaProtocol>rtmp</mediaProtocol><accessControlMessages></accessControlMessages><accessControlActions></accessControlActions><flavorAssets><item><objectType>KalturaFlavorAsset</objectType><id>0_d60nb59y</id><entryId>0_ln0d3cfl</entryId><partnerId>2000092</partnerId><version>1</version><size>39833</size><tags>mobile,web,ipad,ipadnew,mbr</tags><fileExt>mp4</fileExt><createdAt>1405423764</createdAt><updatedAt>1405424079</updatedAt><description>audio warnings: 2112,mencoder#The transcoder (mencoder) can not handle this content. </description><flavorParamsId>33</flavorParamsId><width>0</width><height>0</height><bitrate>129</bitrate><frameRate>0</frameRate><isOriginal>0</isOriginal><isWeb>1</isWeb><containerFormat>isom</containerFormat><status>2</status></item><item><objectType>KalturaFlavorAsset</objectType><id>0_sodum49h</id><entryId>0_ln0d3cfl</entryId><partnerId>2000092</partnerId><version>1</version><size>20172</size><tags>mobile,web,iphone,iphonenew,mbr</tags><fileExt>mp4</fileExt><createdAt>1405423764</createdAt><updatedAt>1405424132</updatedAt><description>audio warnings: 2112,mencoder#The transcoder (mencoder) can not handle this content. </description><flavorParamsId>31</flavorParamsId><width>0</width><height>0</height><bitrate>65</bitrate><frameRate>0</frameRate><isOriginal>0</isOriginal><isWeb>1</isWeb><containerFormat>isom</containerFormat><status>2</status></item></flavorAssets></item><item><objectType>KalturaCuePointListResponse</objectType><objects></objects><totalCount>0</totalCount></item></result><executionTime>0.13522410392761</executionTime></xml>


http://www.radiointereconomia.com/programas/cronica-1/
*/


function calcula() {

$url = 'http://mmp.streamuk.com//api_v3/index.php?service=multirequest&action=null&kalsig=f5bf715cb3bf8c099fc8a26b3ffc8ecc';
$post = "Referer: http://open.http.mmp.streamuk.com/p/2000092/sp/200009200/flash/kdp3/v3.9.3.3.1.31/kdp3.swf\r\n".
		"Content-type: application/x-www-form-urlencoded\r\n".
		"Content-length: 728\r\n".
		urlencode(
			"2:action=getContextData&".
			"2:contextDataParams:objectType=KalturaEntryContextDataParams&".
			"3:filter:objectType=KalturaCuePointFilter&".
			"3:action=list&".
			"ignoreNull=1&".
			"2:contextDataParams:streamerType=rtmp&".
			"2:contextDataParams:referrer={$this->web}&".
			"2:entryId=0_ln0d3cfl&".
			"1:entryId=0_ln0d3cfl&".
			"apiVersion=3.1.5&".
			"1:service=baseentry&".
			"ks=".base64_encode("d2e000426e5d32a45a4eb1f30e26a5a2238ee163|2000092;2000092;1413585766;0;1413499366.0907;0;view:*,widget:1;;")."&".
			"3:filter:entryIdEqual=0_ln0d3cfl&".
			"1:action=get&".
			"3:service=cuepoint_cuepoint&".
			"2:service=baseentry&".
			"1:version=-1&".
			"clientTag=kdp:v3.9.3,cache_st:1405425098"
		);


$ret = CargaWebCurl($url, $post);

if (enString($this->web_descargada,"mp4:")) {
	//http://www.intereconomia.com/sites/default/files/videos/rosa_paya.mp4
	$url="http://www.intereconomia.com/sites/default/files/videos/".entre1y2($this->web_descargada,'mp4:','.mp4').'.mp4';
} elseif (enString($this->web_descargada,"mp3:")) {
	$url="http://www.intereconomia.com/sites/default/files/videos/".entre1y2($this->web_descargada,'mp3:','.mp3').'.mp3';
}

//titulo
$titulo=entre1y2($this->web_descargada,"'Start','","'");

//imagen
$p=strpos($this->web_descargada,'/sites/default/files/imagecache/');
$f=strposF($this->web_descargada,'.',$p)+3;//asÃ­ se soporta .jpg y .gif
$imagen="http://www.intereconomia.com".substr($this->web_descargada,$p,$f-$p);

$obtenido = array(
	'titulo'  => $titulo,
	'imagen'  => $imagen,
	'enlaces' => array(
		array(
			'url'  => $url,
			'tipo' => 'http'
		)
	)
);

finalCadena($obtenido);
}

}
